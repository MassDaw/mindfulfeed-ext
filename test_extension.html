<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test MindfulFeed Extension</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .log {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            border-radius: 4px;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>üß† MindfulFeed Extension - Test</h1>
    
    <div class="test-section">
        <h2>Estado de la Extensi√≥n</h2>
        <div id="extensionStatus" class="status info">Verificando...</div>
        <button onclick="checkExtensionStatus()">Verificar Estado</button>
    </div>

    <div class="test-section">
        <h2>Configuraci√≥n</h2>
        <div id="configStatus" class="status info">Cargando...</div>
        <button onclick="getConfig()">Obtener Configuraci√≥n</button>
        <button onclick="resetConfig()">Reiniciar Configuraci√≥n</button>
    </div>

    <div class="test-section">
        <h2>Estad√≠sticas</h2>
        <div id="statsStatus" class="status info">Cargando...</div>
        <button onclick="getStats()">Obtener Estad√≠sticas</button>
        <button onclick="resetStats()">Reiniciar Estad√≠sticas</button>
        <button onclick="getDetailedStats()">Estad√≠sticas Detalladas</button>
    </div>

    <div class="test-section">
        <h2>Modo Zen</h2>
        <div id="zenStatus" class="status info">Verificando...</div>
        <button onclick="startZenMode()">Iniciar Modo Zen (5 min)</button>
        <button onclick="stopZenMode()">Detener Modo Zen</button>
    </div>

    <div class="test-section">
        <h2>Logs de Actividad</h2>
        <div id="activityLog" class="log"></div>
        <button onclick="clearLog()">Limpiar Log</button>
    </div>

    <script>
        // Funci√≥n para agregar logs
        function addLog(message, type = 'info') {
            const log = document.getElementById('activityLog');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `status ${type}`;
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            log.insertBefore(logEntry, log.firstChild);
        }

        function clearLog() {
            document.getElementById('activityLog').innerHTML = '';
        }

        // Verificar si la extensi√≥n est√° instalada
        function checkExtensionStatus() {
            const statusDiv = document.getElementById('extensionStatus');
            
            if (typeof chrome !== 'undefined' && chrome.runtime && chrome.runtime.id) {
                statusDiv.className = 'status success';
                statusDiv.innerHTML = '‚úÖ Extensi√≥n detectada y funcionando';
                addLog('Extensi√≥n detectada correctamente', 'success');
            } else {
                statusDiv.className = 'status error';
                statusDiv.innerHTML = '‚ùå Extensi√≥n no detectada';
                addLog('Extensi√≥n no detectada', 'error');
            }
        }

        // Obtener configuraci√≥n
        function getConfig() {
            if (typeof chrome !== 'undefined' && chrome.runtime) {
                chrome.runtime.sendMessage({action: 'getConfig'}, (response) => {
                    const statusDiv = document.getElementById('configStatus');
                    if (response && response.success) {
                        statusDiv.className = 'status success';
                        statusDiv.innerHTML = `‚úÖ Configuraci√≥n cargada: Habilitado=${response.config.enabled}, Intervalo=${response.config.interval}min`;
                        addLog(`Configuraci√≥n: ${JSON.stringify(response.config)}`, 'success');
                    } else {
                        statusDiv.className = 'status error';
                        statusDiv.innerHTML = '‚ùå Error al obtener configuraci√≥n';
                        addLog('Error al obtener configuraci√≥n', 'error');
                    }
                });
            }
        }

        // Reiniciar configuraci√≥n
        function resetConfig() {
            if (typeof chrome !== 'undefined' && chrome.runtime) {
                chrome.runtime.sendMessage({action: 'resetConfig'}, (response) => {
                    if (response && response.success) {
                        addLog('Configuraci√≥n reiniciada', 'success');
                        getConfig();
                    } else {
                        addLog('Error al reiniciar configuraci√≥n', 'error');
                    }
                });
            }
        }

        // Obtener estad√≠sticas
        function getStats() {
            if (typeof chrome !== 'undefined' && chrome.runtime) {
                chrome.runtime.sendMessage({action: 'getStats'}, (response) => {
                    const statusDiv = document.getElementById('statsStatus');
                    if (response && response.success) {
                        statusDiv.className = 'status success';
                        statusDiv.innerHTML = `‚úÖ Sesi√≥n actual: ${response.currentSession}min, Total diario: ${response.dailyTotal}min`;
                        addLog(`Estad√≠sticas: Sesi√≥n=${response.currentSession}min, Diario=${response.dailyTotal}min`, 'success');
                    } else {
                        statusDiv.className = 'status error';
                        statusDiv.innerHTML = '‚ùå Error al obtener estad√≠sticas';
                        addLog('Error al obtener estad√≠sticas', 'error');
                    }
                });
            }
        }

        // Reiniciar estad√≠sticas
        function resetStats() {
            if (typeof chrome !== 'undefined' && chrome.runtime) {
                chrome.runtime.sendMessage({action: 'resetStats'}, (response) => {
                    if (response && response.success) {
                        addLog('Estad√≠sticas reiniciadas', 'success');
                        getStats();
                    } else {
                        addLog('Error al reiniciar estad√≠sticas', 'error');
                    }
                });
            }
        }

        // Obtener estad√≠sticas detalladas
        function getDetailedStats() {
            if (typeof chrome !== 'undefined' && chrome.runtime) {
                chrome.runtime.sendMessage({action: 'getDetailedStats'}, (response) => {
                    if (response && response.success) {
                        addLog(`Estad√≠sticas detalladas: ${response.stats.history.length} entradas`, 'success');
                        console.log('Estad√≠sticas detalladas:', response.stats);
                    } else {
                        addLog('Error al obtener estad√≠sticas detalladas', 'error');
                    }
                });
            }
        }

        // Iniciar modo Zen
        function startZenMode() {
            if (typeof chrome !== 'undefined' && chrome.runtime) {
                chrome.runtime.sendMessage({action: 'startZenMode', duration: 5}, (response) => {
                    if (response && response.success) {
                        addLog('Modo Zen iniciado (5 minutos)', 'success');
                        updateZenStatus();
                    } else {
                        addLog('Error al iniciar modo Zen', 'error');
                    }
                });
            }
        }

        // Detener modo Zen
        function stopZenMode() {
            if (typeof chrome !== 'undefined' && chrome.runtime) {
                chrome.runtime.sendMessage({action: 'stopZenMode'}, (response) => {
                    if (response && response.success) {
                        addLog('Modo Zen detenido', 'success');
                        updateZenStatus();
                    } else {
                        addLog('Error al detener modo Zen', 'error');
                    }
                });
            }
        }

        // Actualizar estado del modo Zen
        function updateZenStatus() {
            if (typeof chrome !== 'undefined' && chrome.runtime) {
                chrome.runtime.sendMessage({action: 'getZenStatus'}, (response) => {
                    const statusDiv = document.getElementById('zenStatus');
                    if (response && response.active) {
                        const remaining = Math.ceil((response.endTime - Date.now()) / 60000);
                        statusDiv.className = 'status success';
                        statusDiv.innerHTML = `‚úÖ Modo Zen activo - ${remaining} minutos restantes`;
                    } else {
                        statusDiv.className = 'status info';
                        statusDiv.innerHTML = '‚ÑπÔ∏è Modo Zen inactivo';
                    }
                });
            }
        }

        // Inicializar
        window.onload = function() {
            checkExtensionStatus();
            getConfig();
            getStats();
            updateZenStatus();
            
            // Actualizar cada 5 segundos
            setInterval(() => {
                getStats();
                updateZenStatus();
            }, 5000);
        };
    </script>
</body>
</html> 